import{_ as Q,c as N,a as y,o as n,b as z,d as o,t as x,r as u,e as C,w as p,f as c,n as J,g as L,h as S,i as $,j as f,N as R,M as A,k as W,F as G,l as X,m as H}from"./index-BDTblJxd.js";import{A as K,_ as T}from"./address-CnI4R_s_.js";import{g as Y}from"./address-C-ySnLcQ.js";import{c as Z,p as ee}from"./trade-B4griPZT.js";import{T as te}from"./TradeList-Cgx7Shvn.js";const oe={class:"price-stock"},se={key:0,class:"price"},ae={key:1,class:"price",style:{color:"grey"}},ne={class:"stock"},re={key:0,style:{color:"#f76707"}},ie={key:1},le={key:2},ce={key:3},de={__name:"PriceAndStockShow",props:{price:{type:Number,required:!0},remainQuantity:{type:Number,required:!0},totalQuantity:{type:Number,required:!0}},setup(r){const a=r,s=N(()=>a.price.toFixed(2)),e=N(()=>a.remainQuantity<=0),t=N(()=>a.remainQuantity<=20&&a.remainQuantity>0),d=N(()=>a.totalQuantity-a.remainQuantity<=20);return(h,_)=>(n(),y("div",oe,[e.value?z("",!0):(n(),y("div",se," ￥ "+x(s.value),1)),e.value?(n(),y("div",ae,"已售罄")):z("",!0),o("div",ne,[t.value?(n(),y("span",re,"库存告急，仅剩"+x(r.remainQuantity)+"件",1)):d.value?(n(),y("span",ie,"新品上架，欢迎选购")):e.value?(n(),y("span",le,"商品已售罄，关注其他商品吧")):(n(),y("span",ce,"已售："+x(r.totalQuantity-r.remainQuantity)+" 库存: "+x(r.remainQuantity),1))])]))}},ue=Q(de,[["__scopeId","data-v-357e4803"]]),pe={style:{"border-radius":"12px"}},me={__name:"ProductCard",props:{product:{type:Object,required:!0}},emits:["showProductDetailModal"],setup(r,{emit:a}){const s=r,e=()=>{t("showProductDetailModal",s.product.id)},t=a;return(d,h)=>{const _=u("a-image"),m=u("a-card-meta"),b=u("a-card");return n(),C(b,{hoverable:"",class:"product-card",onClick:e},{cover:p(()=>[o("div",pe,[c(_,{style:J([{overflow:"hidden"},{"border-radius":"12px 12px 18px 0"}]),width:"240px",height:"135px",src:r.product.picture,alt:r.product.name,preview:!1},null,8,["src","alt"])])]),default:p(()=>[c(m,{title:r.product.name,description:r.product.description.length>20?r.product.description.slice(0,18)+"...":r.product.description},{avatar:p(()=>[c(ue,{style:{transform:"translateX(-5px)"},price:r.product.price,totalQuantity:r.product.quantity,remainQuantity:r.product.remainQuantity},null,8,["price","totalQuantity","remainQuantity"])]),_:1},8,["title","description"])]),_:1})}}},_e=Q(me,[["__scopeId","data-v-fed52398"]]),B="/api/product/v1",ve=(r,a)=>L.get(`${B}/product`,{params:{page:r,pageSize:a,categoryName:null}}),fe=(r,a,s)=>L.get(`${B}/product/searchPage`,{params:{query:r,page:a,pageSize:s}}),ye=r=>L.get(`${B}/product/${r}`),he={key:1,class:"address-item"},ge={class:"address-info"},xe={class:"receiver-name"},we={class:"receiver-phone"},be={class:"full-address"},ke={class:"address-actions"},Ce={__name:"OrderAddressChoosedCard",emits:["changeAddress"],setup(r,{expose:a,emit:s}){const e=S({id:"",receiverName:"",receiverPhone:"",province:"",city:"",district:"",detailAddress:"",postCode:""});a({setAddress:_=>{Object.assign(e,_)}});const d=()=>{h("changeAddress")},h=s;return(_,m)=>{const b=u("a-icon"),k=u("a-button");return n(),y("div",null,[e!=null&&e.id?(n(),y("div",he,[o("div",ge,[o("p",xe,x(e.receiverName),1),o("p",we,x(e==null?void 0:e.receiverPhone),1),o("p",be,x(e==null?void 0:e.province)+" / "+x(e==null?void 0:e.city)+" / "+x(e==null?void 0:e.district)+" / "+x(e==null?void 0:e.detailAddress),1)]),o("div",ke,[c(k,{type:"primary",onClick:d},{default:p(()=>m[2]||(m[2]=[$("切换")])),_:1})])])):(n(),y("div",{key:0,class:"address-item address-empty",onClick:d},[c(b,{type:"exclamation-circle"}),m[1]||(m[1]=o("p",null,"您还没有选择收货地址",-1)),c(k,{type:"primary"},{default:p(()=>m[0]||(m[0]=[$("选择收货地址")])),_:1})]))])}}},$e=Q(Ce,[["__scopeId","data-v-e8f2aed1"]]),Pe={__name:"AddressChooseModal",emits:["choose"],setup(r,{expose:a,emit:s}){const e=f(!1),t=f(null),d=()=>{t.value.initAddrress("choose"),e.value=!0},h=m=>{_("choose",m),e.value=!1},_=s;return a({showModal:d}),(m,b)=>{const k=u("a-modal");return n(),C(k,{visible:e.value,"onUpdate:visible":b[0]||(b[0]=i=>e.value=i),title:"选择地址",footer:null,width:800},{default:p(()=>[c(K,{ref_key:"addressManagementRef",ref:t,onChoose:h},null,512)]),_:1},8,["visible"])}}},Ae={class:"order-confirmation"},Qe={class:"card"},De={class:"card"},ze={class:"card"},Me={class:"floating-footer"},Ne={class:"total-price"},Oe={class:"button-group"},Ie={__name:"OrderConfirmationDrawer",setup(r,{expose:a}){const s=f(!1),e=f(null),t=f(""),d=S([]),h=f(null),_=f(!1),m=()=>{s.value=!1},b=async()=>{const w=await ee();h.value=w},k=async()=>{if(_.value==!0)return;if(_.value=!0,A.loading({content:"下单中...",id:"createOrder"}),!e.value.id){A.warning("请选择收货地址");return}if(d.length==0){A.warning("请选择商品");return}const w=d.map(I=>({productId:I.productId,quantity:I.quantity})),l=await Z(h.value==null?null:h.value,e.value.id,w,t.value);l.traceNo?setTimeout(()=>{R.success({title:"下单成功",description:"即将跳转到订单详情页，请尽快完成支付"}),s.value=!1,W.push({name:"Order-Detail",params:{id:l.traceNo}})},1e3):(_.value=!1,R.warning({title:"下单失败",description:l==null?void 0:l.message}))},i=f(null),g=async()=>{const w=await Y();e.value=w||null,i.value.setAddress(e.value)},v=w=>{R.info("请确认订单信息"),s.value=!0,g(),d.splice(0,d.length,...JSON.parse(w)),q(),b()},D=f(null),M=()=>{D.value.showModal()},P=w=>{e.value=w,i.value.setAddress(w)},q=()=>{O.value=d.reduce((w,l)=>w+l.price*l.quantity,0)},O=f(0);return a({showDrawer:v}),(w,l)=>{const I=u("a-divider"),U=u("a-textarea"),j=u("a-statistic"),F=u("a-button"),E=u("a-drawer");return n(),C(E,{visible:s.value,"onUpdate:visible":l[1]||(l[1]=V=>s.value=V),title:"请确认订单",placement:"bottom",height:650,footer:null,unmountOnClose:"","drawer-style":{borderRadius:"12px 12px 0 0",boxShadow:"0 -2px 8px rgba(0, 0, 0, 0.1)"}},{default:p(()=>[o("div",Ae,[o("div",Qe,[l[2]||(l[2]=o("h2",{style:{"margin-bottom":"10px"}},"收货地址",-1)),c($e,{ref_key:"orderAddressChoosedCardRef",ref:i,onChangeAddress:M},null,512)]),o("div",De,[l[3]||(l[3]=o("h2",{style:{"margin-bottom":"10px"}},"商品列表",-1)),c(te,{tradeItems:d},null,8,["tradeItems"])]),c(I),o("div",ze,[l[4]||(l[4]=o("h3",null,"备注信息",-1)),c(U,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=V=>t.value=V),placeholder:"填写备注信息"},null,8,["modelValue"])]),l[5]||(l[5]=o("div",{style:{"min-height":"50px"}},null,-1))]),c(Pe,{ref_key:"addressChooseModalRef",ref:D,onChoose:P},null,512),o("div",Me,[o("div",Ne,[c(j,{title:"总金额",value:O.value,precision:2,"value-from":0,start:!0,animation:""},{prefix:p(()=>l[6]||(l[6]=[$(" ￥ ")])),_:1},8,["value"])]),o("div",Oe,[c(F,{onClick:m,type:"text",style:{"margin-right":"20px",color:"grey"}},{default:p(()=>l[7]||(l[7]=[$("取消")])),_:1}),o("div",{class:"purchase-btn",onClick:k},l[8]||(l[8]=[o("span",{style:{color:"white","font-weight":"bold","font-size":"15px"}}," 确认并结算 ",-1)]))])])]),_:1},8,["visible"])}}},Se=Q(Ie,[["__scopeId","data-v-7a5836fa"]]),qe={class:"product-detail-modal"},Ve={class:"image-section"},Re={class:"info-section"},Le={class:"product-name"},Be={class:"description"},Te={key:0,class:"price"},Ue={key:1,class:"price",style:{color:"grey"}},je={class:"stock-info"},Fe={class:"stock-text"},Ee={class:"stock-text"},Je={style:{"border-radius":"12px"},class:"footer"},We={key:0,class:"total-price"},Ge={key:1,class:"purchase"},Xe={class:"purchase-btn-group"},He={__name:"ProductDetailModal",setup(r,{expose:a}){const s=f(!1),e=f(1),t=S({id:1,name:"商品名称",description:"商品描述",picture:"",price:100,quantity:1e3,remainQuantity:1e3});a({showModal:async k=>{A.loading({content:"加载中...",id:"productDetail"});const i=await ye(k).catch(g=>{A.error({content:`获取商品详情失败,请稍后再试:${g}`,id:"productDetail"})});i.id!=null&&(Object.assign(t,i),console.log(t),s.value=!0,A.success({content:"加载成功",id:"productDetail",duration:500}))}});const h=()=>{s.value=!1,A.success("已加入购物车")},_=f(null),m=()=>{s.value=!1;const k=JSON.stringify([{productId:t.id,productName:t.name,price:t.price,quantity:e.value,model:t.model,picture:t.picture}]);_.value.showDrawer(k)},b=N(()=>(t.price*e.value).toFixed(2));return(k,i)=>{const g=u("a-image"),v=u("a-tag"),D=u("a-input-number"),M=u("a-modal");return n(),C(M,{visible:s.value,"onUpdate:visible":i[1]||(i[1]=P=>s.value=P),title:"商品详情",width:1200,footer:null},{default:p(()=>[o("div",qe,[o("div",Ve,[o("div",null,[c(g,{src:t.picture,alt:t.name,class:"product-image",width:"400px",height:"400px"},null,8,["src","alt"])])]),o("div",Re,[o("h2",Le,x(t.name),1),o("p",Be,x(t.description),1),t.remainQuantity>0?(n(),y("div",Te," 单价: ￥"+x(t.price)+"/件 ",1)):(n(),y("div",Ue,"已售罄")),o("div",je,[o("span",Fe," 已售: "+x(t.quantity-t.remainQuantity),1),o("span",Ee," 剩余库存: "+x(t.remainQuantity),1),t.remainQuantity<=0?(n(),C(v,{key:0,color:"red",style:{"font-size":"12px"}},{default:p(()=>i[2]||(i[2]=[$(" 已售罄 ")])),_:1})):t.remainQuantity<=20?(n(),C(v,{key:1,color:"orange",style:{"font-size":"12px"}},{default:p(()=>i[3]||(i[3]=[$(" 库存告急 ")])),_:1})):t.quantity-t.remainQuantity<=20?(n(),C(v,{key:2,color:"green",style:{"font-size":"12px"}},{default:p(()=>i[4]||(i[4]=[$(" 新品发售 ")])),_:1})):(n(),C(v,{key:3,color:"blue",style:{"font-size":"12px"}},{default:p(()=>i[5]||(i[5]=[$("备货充足")])),_:1}))]),o("div",Je,[t.remainQuantity>0?(n(),y("div",We,[i[6]||(i[6]=o("span",{style:{"font-weight":"bold"}},"总金额：",-1)),$(" ￥"+x(b.value),1)])):z("",!0),t.remainQuantity>0?(n(),y("div",Ge,[o("div",null,[c(D,{style:{width:"220px"},placeholder:"Please Enter",mode:"button",size:"large",class:"input-demo",modelValue:e.value,"onUpdate:modelValue":i[0]||(i[0]=P=>e.value=P),min:1,max:t.remainQuantity},null,8,["modelValue","max"])]),o("div",Xe,[o("div",{class:"purchase-btn",onClick:h},[c(T,{name:"shoppingCartWhite",size:"12px"}),i[7]||(i[7]=o("span",{style:{color:"white","font-weight":"bold","font-size":"15px"}}," 加入购物车 ",-1))]),o("div",{class:"purchase-btn-2",onClick:m},[c(T,{name:"makeOrderWhite",size:"13px"}),i[8]||(i[8]=o("span",{style:{color:"white","font-weight":"bold","font-size":"15px"}}," 直接购买 ",-1))])])])):z("",!0)])])]),c(Se,{ref_key:"OrderConfirmationDrawerRef",ref:_},null,512)]),_:1},8,["visible"])}}},Ke=Q(He,[["__scopeId","data-v-043dea29"]]),Ye={class:"product-list"},Ze={__name:"ProductList",props:{productListInfo:{type:Array,required:!0}},setup(r){const a=f(null),s=e=>{a.value.showModal(e)};return(e,t)=>{const d=u("a-col"),h=u("a-row");return n(),y("div",Ye,[c(h,{gutter:16},{default:p(()=>[(n(!0),y(G,null,X(r.productListInfo,_=>(n(),C(d,{key:_.id,span:6},{default:p(()=>[c(_e,{product:_,onShowProductDetailModal:s},null,8,["product"])]),_:2},1024))),128))]),_:1}),c(Ke,{ref_key:"showProductDetailModalRef",ref:a},null,512)])}}},et=Q(Ze,[["__scopeId","data-v-9d45e4f6"]]),tt={class:"search"},ot={class:"search-Btn-Div"},st={class:"product-list-div"},at={key:3,style:{height:"50px"}},nt={key:4,class:"pagination-div"},rt={__name:"product",setup(r){const a=f(""),s=f(!1),e=S([]),t=f(1),d=f(8),h=f(0);H(()=>{a.value="",m()});const _=()=>{a.value&&a.value.trim()!=""?b():m()},m=async()=>{s.value=!0;const g=await ve(t.value,d.value);e.splice(0,e.length,...g.data),h.value=g.totalCount,s.value=!1},b=async()=>{s.value=!0,t.value=1;const g=await fe(a.value,t.value,d.value).catch(v=>{A.error("搜索失败,请稍后再试:"+v),s.value=!1});e.splice(0,e.length,...g.data),h.value=g.totalCount,s.value=!1},k=g=>{t.value=g,a.value?b():m()},i=g=>{t.value=1,d.value=g,a.value?b():m()};return(g,v)=>{const D=u("icon-search"),M=u("a-input-search"),P=u("a-empty"),q=u("icon-loading"),O=u("a-pagination");return n(),y("div",null,[o("div",tt,[v[2]||(v[2]=o("div",{class:"title"},[o("h1",{style:{margin:"0 auto","text-align":"center","font-size":"45px"}}," 优选好物 ")],-1)),o("div",ot,[c(M,{class:"search-Btn",modelValue:a.value,"onUpdate:modelValue":v[0]||(v[0]=w=>a.value=w),placeholder:"输入商品关键词","search-button":"",onSearch:_,loading:s.value},{"button-icon":p(()=>[c(D)]),"button-default":p(()=>v[1]||(v[1]=[$(" 搜好物 ")])),_:1},8,["modelValue","loading"])])]),o("div",st,[e.length===0&&!s.value?(n(),C(P,{key:0,style:{"padding-top":"80px"}},{default:p(()=>v[3]||(v[3]=[$(" 没有搜索到商品 ")])),_:1})):s.value?(n(),C(P,{key:1,style:{"padding-top":"80px"}},{image:p(()=>[c(q,{style:{"font-size":"68px",color:"#165dff"}})]),default:p(()=>[v[4]||(v[4]=o("div",{style:{"margin-top":"25px","font-size":"20px"}},"加载中，请稍后...",-1))]),_:1})):(n(),C(et,{key:2,"product-list-info":e},null,8,["product-list-info"])),e.length>0&&!s.value?(n(),y("div",at)):z("",!0),e.length>0&&!s.value?(n(),y("div",nt,[c(O,{total:h.value,current:t.value,"page-size":d.value,onChange:k,onPageSizeChange:i,"page-size-options":[8,16,32,64],"show-total":"","show-jumper":"","show-page-size":""},null,8,["total","current","page-size"])])):z("",!0)])])}}},pt=Q(rt,[["__scopeId","data-v-7f02f86c"]]);export{pt as default};

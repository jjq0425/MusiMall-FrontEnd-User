import{_ as D,c as O,a as f,o as r,b as M,d as o,t as x,r as u,e as C,w as m,f as d,n as J,g as L,h as q,i as $,j as v,N as T,M as k,k as W,F as G,l as X,m as H}from"./index-BsPeHFIG.js";import{a as K}from"./cart-CJWFkMLK.js";import{A as Y,_ as B}from"./address-CPPjdGQw.js";import{g as Z}from"./address-DeCBlWC9.js";import{c as ee,p as te}from"./trade-C9v3FZYx.js";import{T as oe}from"./TradeList-DQkI5J79.js";const se={class:"price-stock"},ae={key:0,class:"price"},ne={key:1,class:"price",style:{color:"grey"}},re={class:"stock"},ie={key:0,style:{color:"#f76707"}},le={key:1},de={key:2},ce={key:3},ue={__name:"PriceAndStockShow",props:{price:{type:Number,required:!0},remainQuantity:{type:Number,required:!0},totalQuantity:{type:Number,required:!0}},setup(i){const n=i,s=O(()=>n.price.toFixed(2)),e=O(()=>n.remainQuantity<=0),t=O(()=>n.remainQuantity<=20&&n.remainQuantity>0),c=O(()=>n.totalQuantity-n.remainQuantity<=20);return(_,y)=>(r(),f("div",se,[e.value?M("",!0):(r(),f("div",ae," ￥ "+x(s.value),1)),e.value?(r(),f("div",ne,"已售罄")):M("",!0),o("div",re,[t.value?(r(),f("span",ie,"库存告急，仅剩"+x(i.remainQuantity)+"件",1)):c.value?(r(),f("span",le,"新品上架，欢迎选购")):e.value?(r(),f("span",de,"商品已售罄，关注其他商品吧")):(r(),f("span",ce,"已售："+x(i.totalQuantity-i.remainQuantity)+" 库存: "+x(i.remainQuantity),1))])]))}},pe=D(ue,[["__scopeId","data-v-357e4803"]]),me={style:{"border-radius":"12px"}},_e={__name:"ProductCard",props:{product:{type:Object,required:!0}},emits:["showProductDetailModal"],setup(i,{emit:n}){const s=i,e=()=>{t("showProductDetailModal",s.product.id)},t=n;return(c,_)=>{const y=u("a-image"),p=u("a-card-meta"),b=u("a-card");return r(),C(b,{hoverable:"",class:"product-card",onClick:e},{cover:m(()=>[o("div",me,[d(y,{style:J([{overflow:"hidden"},{"border-radius":"12px 12px 18px 0"}]),width:"240px",height:"135px",src:i.product.picture,alt:i.product.name,preview:!1},null,8,["src","alt"])])]),default:m(()=>[d(p,{title:i.product.name,description:i.product.description.length>20?i.product.description.slice(0,18)+"...":i.product.description},{avatar:m(()=>[d(pe,{style:{transform:"translateX(-5px)"},price:i.product.price,totalQuantity:i.product.quantity,remainQuantity:i.product.remainQuantity},null,8,["price","totalQuantity","remainQuantity"])]),_:1},8,["title","description"])]),_:1})}}},ve=D(_e,[["__scopeId","data-v-fed52398"]]),R="/api/product/v1",fe=(i,n)=>L.get(`${R}/product`,{params:{page:i,pageSize:n,categoryName:null}}),ye=(i,n,s)=>L.get(`${R}/product/searchPage`,{params:{query:i,page:n,pageSize:s}}),he=i=>L.get(`${R}/product/${i}`),ge={key:1,class:"address-item"},xe={class:"address-info"},we={class:"receiver-name"},be={class:"receiver-phone"},ke={class:"full-address"},Ce={class:"address-actions"},$e={__name:"OrderAddressChoosedCard",emits:["changeAddress"],setup(i,{expose:n,emit:s}){const e=q({id:"",receiverName:"",receiverPhone:"",province:"",city:"",district:"",detailAddress:"",postCode:""});n({setAddress:y=>{Object.assign(e,y)}});const c=()=>{_("changeAddress")},_=s;return(y,p)=>{const b=u("a-icon"),P=u("a-button");return r(),f("div",null,[e!=null&&e.id?(r(),f("div",ge,[o("div",xe,[o("p",we,x(e.receiverName),1),o("p",be,x(e==null?void 0:e.receiverPhone),1),o("p",ke,x(e==null?void 0:e.province)+" / "+x(e==null?void 0:e.city)+" / "+x(e==null?void 0:e.district)+" / "+x(e==null?void 0:e.detailAddress),1)]),o("div",Ce,[d(P,{type:"primary",onClick:c},{default:m(()=>p[2]||(p[2]=[$("切换")])),_:1})])])):(r(),f("div",{key:0,class:"address-item address-empty",onClick:c},[d(b,{type:"exclamation-circle"}),p[1]||(p[1]=o("p",null,"您还没有选择收货地址",-1)),d(P,{type:"primary"},{default:m(()=>p[0]||(p[0]=[$("选择收货地址")])),_:1})]))])}}},Pe=D($e,[["__scopeId","data-v-e8f2aed1"]]),Ae={__name:"AddressChooseModal",emits:["choose"],setup(i,{expose:n,emit:s}){const e=v(!1),t=v(null),c=()=>{t.value.initAddrress("choose"),e.value=!0},_=p=>{y("choose",p),e.value=!1},y=s;return n({showModal:c}),(p,b)=>{const P=u("a-modal");return r(),C(P,{visible:e.value,"onUpdate:visible":b[0]||(b[0]=g=>e.value=g),title:"选择地址",footer:null,width:800},{default:m(()=>[d(Y,{ref_key:"addressManagementRef",ref:t,onChoose:_},null,512)]),_:1},8,["visible"])}}},Qe={class:"order-confirmation"},De={class:"card"},ze={class:"card"},Me={class:"card"},Ne={class:"floating-footer"},Oe={class:"total-price"},Ie={class:"button-group"},Se={__name:"OrderConfirmationDrawer",setup(i,{expose:n}){const s=v(!1),e=v(null),t=v(""),c=q([]),_=v(null),y=v(!1),p=()=>{s.value=!1},b=async()=>{const w=await te();_.value=w},P=async()=>{if(y.value==!0)return;if(y.value=!0,k.loading({content:"下单中...",id:"createOrder"}),!e.value.id){k.warning("请选择收货地址");return}if(c.length==0){k.warning("请选择商品");return}const w=c.map(S=>({productId:S.productId,quantity:S.quantity})),l=await ee(_.value==null?null:_.value,e.value.id,w,t.value);l.traceNo?setTimeout(()=>{T.success({title:"下单成功",description:"即将跳转到订单详情页，请尽快完成支付"}),s.value=!1,W.push({name:"Order-Detail",params:{id:l.traceNo}})},1e3):(y.value=!1,T.warning({title:"下单失败",description:l==null?void 0:l.message}))},g=v(null),a=async()=>{const w=await Z();e.value=w||null,g.value.setAddress(e.value)},h=w=>{T.info("请确认订单信息"),s.value=!0,a(),c.splice(0,c.length,...JSON.parse(w)),Q(),b()},A=v(null),N=()=>{A.value.showModal()},z=w=>{e.value=w,g.value.setAddress(w)},Q=()=>{I.value=c.reduce((w,l)=>w+l.price*l.quantity,0)},I=v(0);return n({showDrawer:h}),(w,l)=>{const S=u("a-divider"),U=u("a-textarea"),j=u("a-statistic"),F=u("a-button"),E=u("a-drawer");return r(),C(E,{visible:s.value,"onUpdate:visible":l[1]||(l[1]=V=>s.value=V),title:"请确认订单",placement:"bottom",height:650,footer:null,unmountOnClose:"","drawer-style":{borderRadius:"12px 12px 0 0",boxShadow:"0 -2px 8px rgba(0, 0, 0, 0.1)"}},{default:m(()=>[o("div",Qe,[o("div",De,[l[2]||(l[2]=o("h2",{style:{"margin-bottom":"10px"}},"收货地址",-1)),d(Pe,{ref_key:"orderAddressChoosedCardRef",ref:g,onChangeAddress:N},null,512)]),o("div",ze,[l[3]||(l[3]=o("h2",{style:{"margin-bottom":"10px"}},"商品列表",-1)),d(oe,{tradeItems:c},null,8,["tradeItems"])]),d(S),o("div",Me,[l[4]||(l[4]=o("h3",null,"备注信息",-1)),d(U,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=V=>t.value=V),placeholder:"填写备注信息"},null,8,["modelValue"])]),l[5]||(l[5]=o("div",{style:{"min-height":"50px"}},null,-1))]),d(Ae,{ref_key:"addressChooseModalRef",ref:A,onChoose:z},null,512),o("div",Ne,[o("div",Oe,[d(j,{title:"总金额",value:I.value,precision:2,"value-from":0,start:!0,animation:""},{prefix:m(()=>l[6]||(l[6]=[$(" ￥ ")])),_:1},8,["value"])]),o("div",Ie,[d(F,{onClick:p,type:"text",style:{"margin-right":"20px",color:"grey"}},{default:m(()=>l[7]||(l[7]=[$("取消")])),_:1}),o("div",{class:"purchase-btn",onClick:P},l[8]||(l[8]=[o("span",{style:{color:"white","font-weight":"bold","font-size":"15px"}}," 确认并结算 ",-1)]))])])]),_:1},8,["visible"])}}},qe=D(Se,[["__scopeId","data-v-7a5836fa"]]),Ve={class:"product-detail-modal"},Te={class:"image-section"},Le={class:"info-section"},Re={class:"product-name"},Be={class:"description"},Ue={key:0,class:"price"},je={key:1,class:"price",style:{color:"grey"}},Fe={class:"stock-info"},Ee={class:"stock-text"},Je={class:"stock-text"},We={style:{"border-radius":"12px"},class:"footer"},Ge={key:0,class:"total-price"},Xe={key:1,class:"purchase"},He={class:"purchase-btn-group"},Ke={__name:"ProductDetailModal",setup(i,{expose:n}){const s=v(!1),e=v(1),t=q({id:1,name:"商品名称",description:"商品描述",picture:"",price:100,quantity:1e3,remainQuantity:1e3});n({showModal:async g=>{k.loading({content:"加载中...",id:"productDetail"});const a=await he(g).catch(h=>{k.error({content:`获取商品详情失败,请稍后再试:${h}`,id:"productDetail"})});a.id!=null&&(Object.assign(t,a),console.log(t),s.value=!0,k.success({content:"加载成功",id:"productDetail",duration:500}))}});const _=v(!1),y=async()=>{if(_.value)return;if(_.value=!0,k.loading({content:"加入购物车中...",id:"addToCart"}),e.value>t.remainQuantity){k.error("购买数量超过库存");return}if(e.value<=0){k.error("购买数量不能小于1");return}const g=await K(t.id,e.value).finally(()=>{_.value=!1});g.code==200?k.success({content:g.message==null?"加入购物车成功":g.message,id:"addToCart",duration:500}):k.error({content:"加入购物车失败",id:"addToCart",duration:500}),_.value=!1,s.value=!1},p=v(null),b=()=>{s.value=!1;const g=JSON.stringify([{productId:t.id,productName:t.name,price:t.price,quantity:e.value,model:t.model,picture:t.picture}]);p.value.showDrawer(g)},P=O(()=>(t.price*e.value).toFixed(2));return(g,a)=>{const h=u("a-image"),A=u("a-tag"),N=u("a-input-number"),z=u("a-modal");return r(),C(z,{visible:s.value,"onUpdate:visible":a[1]||(a[1]=Q=>s.value=Q),title:"商品详情",width:1200,footer:null},{default:m(()=>[o("div",Ve,[o("div",Te,[o("div",null,[d(h,{src:t.picture,alt:t.name,class:"product-image",width:"400px",height:"400px"},null,8,["src","alt"])])]),o("div",Le,[o("h2",Re,x(t.name),1),o("p",Be,x(t.description),1),t.remainQuantity>0?(r(),f("div",Ue," 单价: ￥"+x(t.price)+"/件 ",1)):(r(),f("div",je,"已售罄")),o("div",Fe,[o("span",Ee," 已售: "+x(t.quantity-t.remainQuantity),1),o("span",Je," 剩余库存: "+x(t.remainQuantity),1),t.remainQuantity<=0?(r(),C(A,{key:0,color:"red",style:{"font-size":"12px"}},{default:m(()=>a[2]||(a[2]=[$(" 已售罄 ")])),_:1})):t.remainQuantity<=20?(r(),C(A,{key:1,color:"orange",style:{"font-size":"12px"}},{default:m(()=>a[3]||(a[3]=[$(" 库存告急 ")])),_:1})):t.quantity-t.remainQuantity<=20?(r(),C(A,{key:2,color:"green",style:{"font-size":"12px"}},{default:m(()=>a[4]||(a[4]=[$(" 新品发售 ")])),_:1})):(r(),C(A,{key:3,color:"blue",style:{"font-size":"12px"}},{default:m(()=>a[5]||(a[5]=[$("备货充足")])),_:1}))]),o("div",We,[t.remainQuantity>0?(r(),f("div",Ge,[a[6]||(a[6]=o("span",{style:{"font-weight":"bold"}},"总金额：",-1)),$(" ￥"+x(P.value),1)])):M("",!0),t.remainQuantity>0?(r(),f("div",Xe,[o("div",null,[d(N,{style:{width:"220px"},placeholder:"Please Enter",mode:"button",size:"large",class:"input-demo",modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=Q=>e.value=Q),min:1,max:t.remainQuantity},null,8,["modelValue","max"])]),o("div",He,[o("div",{class:"purchase-btn",onClick:y},[d(B,{name:"shoppingCartWhite",size:"12px"}),a[7]||(a[7]=o("span",{style:{color:"white","font-weight":"bold","font-size":"15px"}}," 加入购物车 ",-1))]),o("div",{class:"purchase-btn-2",onClick:b},[d(B,{name:"makeOrderWhite",size:"13px"}),a[8]||(a[8]=o("span",{style:{color:"white","font-weight":"bold","font-size":"15px"}}," 直接购买 ",-1))])])])):M("",!0)])])]),d(qe,{ref_key:"OrderConfirmationDrawerRef",ref:p},null,512)]),_:1},8,["visible"])}}},Ye=D(Ke,[["__scopeId","data-v-9008e3ff"]]),Ze={class:"product-list"},et={__name:"ProductList",props:{productListInfo:{type:Array,required:!0}},setup(i){const n=v(null),s=e=>{n.value.showModal(e)};return(e,t)=>{const c=u("a-col"),_=u("a-row");return r(),f("div",Ze,[d(_,{gutter:16},{default:m(()=>[(r(!0),f(G,null,X(i.productListInfo,y=>(r(),C(c,{key:y.id,span:6},{default:m(()=>[d(ve,{product:y,onShowProductDetailModal:s},null,8,["product"])]),_:2},1024))),128))]),_:1}),d(Ye,{ref_key:"showProductDetailModalRef",ref:n},null,512)])}}},tt=D(et,[["__scopeId","data-v-9d45e4f6"]]),ot={class:"search"},st={class:"search-Btn-Div"},at={class:"product-list-div"},nt={key:3,style:{height:"50px"}},rt={key:4,class:"pagination-div"},it={__name:"product",setup(i){const n=v(""),s=v(!1),e=q([]),t=v(1),c=v(8),_=v(0);H(()=>{n.value="",p()});const y=()=>{n.value&&n.value.trim()!=""?b():p()},p=async()=>{s.value=!0;const a=await fe(t.value,c.value);e.splice(0,e.length,...a.data),_.value=a.totalCount,s.value=!1},b=async()=>{s.value=!0,t.value=1;const a=await ye(n.value,t.value,c.value).catch(h=>{k.error("搜索失败,请稍后再试:"+h),s.value=!1});e.splice(0,e.length,...a.data),_.value=a.totalCount,s.value=!1},P=a=>{t.value=a,n.value?b():p()},g=a=>{t.value=1,c.value=a,n.value?b():p()};return(a,h)=>{const A=u("icon-search"),N=u("a-input-search"),z=u("a-empty"),Q=u("icon-loading"),I=u("a-pagination");return r(),f("div",null,[o("div",ot,[h[2]||(h[2]=o("div",{class:"title"},[o("h1",{style:{margin:"0 auto","text-align":"center","font-size":"45px"}}," 优选好物 ")],-1)),o("div",st,[d(N,{class:"search-Btn",modelValue:n.value,"onUpdate:modelValue":h[0]||(h[0]=w=>n.value=w),placeholder:"输入商品关键词","search-button":"",onSearch:y,loading:s.value},{"button-icon":m(()=>[d(A)]),"button-default":m(()=>h[1]||(h[1]=[$(" 搜好物 ")])),_:1},8,["modelValue","loading"])])]),o("div",at,[e.length===0&&!s.value?(r(),C(z,{key:0,style:{"padding-top":"80px"}},{default:m(()=>h[3]||(h[3]=[$(" 没有搜索到商品 ")])),_:1})):s.value?(r(),C(z,{key:1,style:{"padding-top":"80px"}},{image:m(()=>[d(Q,{style:{"font-size":"68px",color:"#165dff"}})]),default:m(()=>[h[4]||(h[4]=o("div",{style:{"margin-top":"25px","font-size":"20px"}},"加载中，请稍后...",-1))]),_:1})):(r(),C(tt,{key:2,"product-list-info":e},null,8,["product-list-info"])),e.length>0&&!s.value?(r(),f("div",nt)):M("",!0),e.length>0&&!s.value?(r(),f("div",rt,[d(I,{total:_.value,current:t.value,"page-size":c.value,onChange:P,onPageSizeChange:g,"page-size-options":[8,16,32,64],"show-total":"","show-jumper":"","show-page-size":""},null,8,["total","current","page-size"])])):M("",!0)])])}}},_t=D(it,[["__scopeId","data-v-7f02f86c"]]);export{_t as default};

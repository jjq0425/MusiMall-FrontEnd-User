import{a as ge}from"./address-DlEV7Mks.js";import{b as ve,p as _e}from"./trade-DPy_x36Y.js";import{G as E,_ as se,h as J,r as m,a as j,o as b,f as d,d as i,w as c,i as I,t as $,g as C,e as P,m as he,H,b as B,p as ye,v as be,E as Ce,M as w,N as ee,q as xe}from"./index-sth_sD6C.js";import{A as we}from"./address-DLRT3axI.js";import{T as Te}from"./TradeList-BGZgQpI0.js";const U="/api/shoppingCart/v1/shoppingCart",ke=(e,o)=>E({url:`${U}/getShoppingCart`,method:"post",data:{pageNo:e,pageSize:o}}),jt=(e,o)=>E({url:`${U}/insertOrUpdate`,method:"post",data:{productId:e,quantity:o}}),Ie=e=>E({url:`${U}/deleteProduct/${e}`,method:"put"}),ie=e=>E({url:`${U}/deleteProducts`,method:"put",data:e}),Oe=()=>E({url:`${U}/clearCart`,method:"put"}),Ae=(e,o)=>E({url:`${U}/updateShoppingCart`,method:"put",data:{id:e,quantity:o}}),Se={key:1,class:"address-item"},$e={class:"address-info"},Pe={class:"receiver-name"},Ne={class:"receiver-phone"},je={class:"full-address"},De={class:"address-actions"},qe={__name:"OrderAddressChoosedCard",emits:["changeAddress"],setup(e,{expose:o,emit:y}){const t=J({id:"",receiverName:"",receiverPhone:"",province:"",city:"",district:"",detailAddress:"",postCode:""});o({setAddress:l=>{Object.assign(t,l)}});const _=()=>{v("changeAddress")},v=y;return(l,r)=>{const T=m("a-icon"),f=m("a-button");return b(),j("div",null,[t!=null&&t.id?(b(),j("div",Se,[i("div",$e,[i("p",Pe,$(t.receiverName),1),i("p",Ne,$(t==null?void 0:t.receiverPhone),1),i("p",je,$(t==null?void 0:t.province)+" / "+$(t==null?void 0:t.city)+" / "+$(t==null?void 0:t.district)+" / "+$(t==null?void 0:t.detailAddress),1)]),i("div",De,[d(f,{type:"primary",onClick:_},{default:c(()=>r[2]||(r[2]=[I("切换")])),_:1})])])):(b(),j("div",{key:0,class:"address-item address-empty",onClick:_},[d(T,{type:"exclamation-circle"}),r[1]||(r[1]=i("p",null,"您还没有选择收货地址",-1)),d(f,{type:"primary"},{default:c(()=>r[0]||(r[0]=[I("选择收货地址")])),_:1})]))])}}},Me=se(qe,[["__scopeId","data-v-e8f2aed1"]]),Re={__name:"AddressChooseModal",emits:["choose"],setup(e,{expose:o,emit:y}){const t=C(!1),g=C(null),_=()=>{g.value.initAddrress("choose"),t.value=!0},v=r=>{l("choose",r),t.value=!1},l=y;return o({showModal:_}),(r,T)=>{const f=m("a-modal");return b(),P(f,{visible:t.value,"onUpdate:visible":T[0]||(T[0]=k=>t.value=k),title:"选择地址",footer:null,width:800},{default:c(()=>[d(we,{ref_key:"addressManagementRef",ref:g,onChoose:v},null,512)]),_:1},8,["visible"])}}};var Le=typeof global=="object"&&global&&global.Object===Object&&global,Ve=typeof self=="object"&&self&&self.Object===Object&&self,le=Le||Ve||Function("return this")(),Q=le.Symbol,ce=Object.prototype,Be=ce.hasOwnProperty,Ee=ce.toString,W=Q?Q.toStringTag:void 0;function Ue(e){var o=Be.call(e,W),y=e[W];try{e[W]=void 0;var t=!0}catch{}var g=Ee.call(e);return t&&(o?e[W]=y:delete e[W]),g}var ze=Object.prototype,Fe=ze.toString;function We(e){return Fe.call(e)}var Ge="[object Null]",He="[object Undefined]",ae=Q?Q.toStringTag:void 0;function Je(e){return e==null?e===void 0?He:Ge:ae&&ae in Object(e)?Ue(e):We(e)}function Qe(e){return e!=null&&typeof e=="object"}var Xe="[object Symbol]";function Ze(e){return typeof e=="symbol"||Qe(e)&&Je(e)==Xe}var Ke=/\s/;function Ye(e){for(var o=e.length;o--&&Ke.test(e.charAt(o)););return o}var et=/^\s+/;function tt(e){return e&&e.slice(0,Ye(e)+1).replace(et,"")}function ne(e){var o=typeof e;return e!=null&&(o=="object"||o=="function")}var oe=NaN,nt=/^[-+]0x[0-9a-f]+$/i,at=/^0b[01]+$/i,ot=/^0o[0-7]+$/i,rt=parseInt;function re(e){if(typeof e=="number")return e;if(Ze(e))return oe;if(ne(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=ne(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=tt(e);var y=at.test(e);return y||ot.test(e)?rt(e.slice(2),y?2:8):nt.test(e)?oe:+e}var te=function(){return le.Date.now()},st="Expected a function",it=Math.max,lt=Math.min;function ct(e,o,y){var t,g,_,v,l,r,T=0,f=!1,k=!1,A=!0;if(typeof e!="function")throw new TypeError(st);o=re(o)||0,ne(y)&&(f=!!y.leading,k="maxWait"in y,_=k?it(re(y.maxWait)||0,o):_,A="trailing"in y?!!y.trailing:A);function D(u){var s=t,n=g;return t=g=void 0,T=u,v=e.apply(n,s),v}function O(u){return T=u,l=setTimeout(N,o),f?D(u):v}function R(u){var s=u-r,n=u-T,a=o-s;return k?lt(a,_-n):a}function q(u){var s=u-r,n=u-T;return r===void 0||s>=o||s<0||k&&n>=_}function N(){var u=te();if(q(u))return L(u);l=setTimeout(N,R(u))}function L(u){return l=void 0,A&&t?D(u):(t=g=void 0,v)}function M(){l!==void 0&&clearTimeout(l),T=0,t=r=g=l=void 0}function z(){return l===void 0?v:L(te())}function S(){var u=te(),s=q(u);if(t=arguments,g=this,r=u,s){if(l===void 0)return O(r);if(k)return clearTimeout(l),l=setTimeout(N,o),D(r)}return l===void 0&&(l=setTimeout(N,o)),v}return S.cancel=M,S.flush=z,S}const dt={style:{"font-size":"16px","font-weight":"bold"}},ut={style:{"font-size":"16px",color:"red","font-weight":"bold"}},pt={key:1},ft={class:"trade-item-picture"},mt={__name:"CartProductList",props:{canChange:{type:Boolean,default:!0}},emits:["updateTotalCount","updateSelectProductId","updateChangeItemLoading","updateTotalPrice"],setup(e,{expose:o,emit:y}){const t=J([]),g=C(1);let _=10;const v=C(0),l=C(!1),r=C(!1),T=C(!1),f=J([]),k=e,A=async()=>{r.value=!0,w.loading({content:"加载中...",id:"cart-data"});const a=await ke(g.value,_).finally(()=>{r.value=!1});l.value?_>0&&t.splice((g.value-1)*_,_,...a.data):t.push(...a.data),w.success({content:"加载成功",id:"cart-data"}),r.value=!1,t.length>=a.totalCount?l.value=!0:(l.value=!1,g.value++),v.value=a.totalCount,u()},D=async a=>{w.loading({content:"删除中...",id:"cart-data"});const p=await Ie(a);p.code===200?(w.success({content:p.message==null?"删除成功":p.message,id:"cart-data"}),R()):w.error({content:p.message==null?"删除失败":p.message,id:"cart-data"})},O=async()=>{if(console.log(f),f.length===0){w.warning({content:"请先选择要删除的商品"});return}w.loading({content:"删除中...",id:"cart-data"});const a=await ie(f);a.code===200?(w.success({content:a.message==null?"删除成功":a.message,id:"cart-data"}),R()):w.error({content:a.message==null?"删除失败":a.message,id:"cart-data"})},R=()=>{t.splice(0,t.length),g.value=1,f.splice(0,f.length),A()},q=ct(async(a,p)=>{const h=await Ae(a,p);h.code===200||w.error({content:h.message==null?"更新失败":h.message})},1e3),N=a=>f.includes(a),L=a=>{if(f.includes(a)){const p=f.findIndex(h=>h===a);f.splice(p,1)}else f.push(a)},M=C(null),z=()=>{if(f.length===0){w.warning({content:"请先选择要结算的商品"});return}const p=t.filter(h=>f.includes(h.id)).map(h=>({cartId:h.id,productId:h.productId,quantity:h.quantity,productName:h.name,price:h.price,model:h.model,picture:h.cover}));M.value.showDrawer(JSON.stringify(p),"cartPart")},S=C(0),u=()=>{S.value=t.reduce((a,p)=>a+p.price*p.quantity,0),console.log(S.value)},s=()=>{if(t.length===0){w.warning({content:"购物车为空，无法结算"});return}M.value.showDrawer(null,"cartAll")};he(()=>{A(),k.canChange||(_=0)}),H(v,a=>{n("updateTotalCount",a)}),H(f,a=>{n("updateSelectProductId",a)}),H(T,a=>{n("updateChangeItemLoading",a)}),H(S,a=>{n("updateTotalPrice",a)});const n=y;return o({removeSelectCartItem:O,createOrderAll:s,createSelectOrder:z}),(a,p)=>{const h=m("a-empty"),X=m("icon-loading"),Z=m("a-spin"),K=m("a-checkbox"),V=m("a-descriptions-item"),Y=m("a-input-number"),F=m("a-button"),de=m("a-descriptions"),ue=m("a-list-item-meta"),pe=m("a-image"),fe=m("a-list-item"),me=m("a-list");return b(),j("div",null,[t.length===0&&!r.value?(b(),P(h,{key:0},{default:c(()=>p[0]||(p[0]=[I(" 购物车空空如也 ")])),_:1})):r.value&&t.length==0?(b(),P(h,{key:1},{image:c(()=>[d(X,{style:{"font-size":"68px",color:"#165dff"}})]),default:c(()=>[p[1]||(p[1]=i("div",{style:{"margin-top":"25px","font-size":"20px"}},"加载中，请稍后...",-1))]),_:1})):B("",!0),ye(d(me,{data:t,"max-height":500,onReachBottom:A,scrollbar:!0,style:{"overflow-y":"always",cursor:"pointer"},hoverable:""},{"scroll-loading":c(()=>[l.value&&!r.value?(b(),j("div",{key:0,onClick:A,style:{cursor:"pointer",color:"grey"}}," —— 我是有底线的 —— ")):(b(),P(Z,{key:1}))]),item:c(({item:x})=>[d(fe,null,{extra:c(()=>[i("div",ft,[d(pe,{src:x.cover,alt:x.productName,width:"110px",height:"110px"},null,8,["src","alt"])])]),default:c(()=>[d(ue,null,{avatar:c(()=>[k.canChange?(b(),P(K,{key:0,"model-value":N(x.id),onChange:G=>L(x.id)},null,8,["model-value","onChange"])):B("",!0)]),title:c(()=>[i("div",dt,[I($(x.productName)+" ",1),i("span",ut," ￥"+$((x.price*x.quantity).toFixed(2)),1)])]),description:c(()=>[d(de,{column:3,size:"small",style:{"margin-top":"10px",width:"95vh"}},{default:c(()=>[d(V,{label:"型号/描述",span:3},{default:c(()=>[I($(x.model),1)]),_:2},1024),d(V,{label:"单价"},{default:c(()=>[I("￥"+$(x.price.toFixed(2)),1)]),_:2},1024),d(V,{label:"购买数量"},{default:c(()=>[k.canChange?(b(),P(Y,{key:0,modelValue:x.quantity,"onUpdate:modelValue":G=>x.quantity=G,min:1,max:x.stock,mode:"button",style:{width:"150px"},onChange:G=>Ce(q)(x.id,x.quantity)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])):(b(),j("span",pt,$(x.quantity),1))]),_:2},1024),k.canChange?(b(),P(V,{key:0,label:""},{default:c(()=>[d(F,{type:"text",onClick:G=>D(x.id),style:{color:"red",transform:"translateX(-10vh)"}},{default:c(()=>p[2]||(p[2]=[I(" 移除 ")])),_:2},1032,["onClick"])]),_:2},1024)):B("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["data"]),[[be,t.length>0]]),d(Ot,{ref_key:"orderConfirmationDrawerRef",ref:M},null,512)])}}},gt={class:"order-confirmation"},vt={class:"card"},_t={class:"card"},ht={key:0,style:{"font-weight":"bold"}},yt={key:1},bt={class:"card"},Ct={class:"card"},xt={class:"floating-footer"},wt={class:"total-price"},Tt={class:"button-group"},kt={style:{color:"white","font-weight":"bold","font-size":"15px"}},It={__name:"OrderConfirmationDrawer",emits:["confirmOrder"],setup(e,{expose:o,emit:y}){const t=C(!1),g=C(null),_=C(""),v=J([]),l=C(null),r=C(!1),T=()=>{t.value=!1},f=async()=>{const s=await _e();l.value=s},k=async()=>{if(r.value==!0)return;if(r.value=!0,w.loading({content:"下单中...",id:"createOrder"}),!g.value.id){w.warning("请选择收货地址");return}if(v.length==0&&O.value!="cartAll"){w.warning("请选择商品");return}let s=null;O.value!="cartAll"&&(s=v.map(a=>({productId:a.productId,quantity:a.quantity})));const n=await ve(O.value==="cartAll"?"cartAll":"direct",l.value==null?null:l.value,g.value.id,s,_.value);n.traceNo?(setTimeout(()=>{r.value=!1,ee.success({title:"下单成功",content:"即将跳转到订单详情页，请尽快完成支付。实际应付金额以支付详情页为准。",duration:2e3}),xe.push({name:"Order-Detail",params:{id:n.traceNo}}),setTimeout(()=>{t.value=!1},1e3)},1e3),O.value==="cartAll"?(Oe(),u("confirmOrder")):O.value==="cartPart"&&(ie(v.map(a=>a.cartId)),u("confirmOrder"))):(r.value=!1,ee.warning({title:"下单失败",content:n==null?void 0:n.message}))},A=C(null),D=async()=>{const s=await ge();g.value=s||null,A.value.setAddress(g.value)},O=C("direct"),R=(s,n="direct")=>{ee.info("请确认订单信息"),O.value=n,t.value=!0,D(),(n=="direct"||n=="cartPart")&&v.splice(0,v.length,...JSON.parse(s)),M(),f()},q=C(null),N=()=>{q.value.showModal()},L=s=>{g.value=s,A.value.setAddress(s)},M=()=>{S.value=v.reduce((s,n)=>s+n.price*n.quantity,0)},z=s=>{S.value=s},S=C(0),u=y;return o({showDrawer:R}),(s,n)=>{const a=m("icon-exclamation-circle-fill"),p=m("a-alert"),h=m("a-divider"),X=m("a-textarea"),Z=m("a-statistic"),K=m("a-button"),V=m("icon-loading"),Y=m("a-drawer");return b(),P(Y,{visible:t.value,"onUpdate:visible":n[1]||(n[1]=F=>t.value=F),title:"请确认订单",placement:"bottom",height:650,footer:null,unmountOnClose:"","drawer-style":{borderRadius:"12px 12px 0 0",boxShadow:"0 -2px 8px rgba(0, 0, 0, 0.1)",zIndex:9990}},{default:c(()=>[i("div",null,[i("div",null,[i("div",gt,[i("div",vt,[n[2]||(n[2]=i("h2",{style:{"margin-bottom":"10px"}},"收货地址",-1)),d(Me,{ref_key:"orderAddressChoosedCardRef",ref:A,onChangeAddress:N},null,512)]),i("div",_t,[n[5]||(n[5]=i("h2",{style:{"margin-bottom":"10px"}},"商品列表",-1)),d(p,{type:"normal"},{icon:c(()=>[d(a)]),default:c(()=>[n[4]||(n[4]=I(" 请确认订单信息，价格以订单支付详情页展示为准。 ")),O.value=="cartAll"?(b(),j("span",ht,n[3]||(n[3]=[I("请注意当前为结算购物车"),i("span",{style:{color:"red"}},"全部商品",-1),I("。结算后将清空购物车。 ")]))):B("",!0),O.value=="cartPart"?(b(),j("span",yt,"结算后将从购物车中移除所购商品")):B("",!0)]),_:1}),O.value!="cartAll"?(b(),P(Te,{key:0,tradeItems:v},null,8,["tradeItems"])):(b(),P(mt,{key:1,canChange:!1,onUpdateTotalPrice:z}))]),d(h),i("div",bt,[n[6]||(n[6]=i("h3",null,"备注信息",-1)),d(X,{modelValue:_.value,"onUpdate:modelValue":n[0]||(n[0]=F=>_.value=F),placeholder:"填写备注信息"},null,8,["modelValue"])]),i("div",Ct,[d(p,{type:"normal"},{icon:c(()=>[d(a)]),default:c(()=>[n[7]||(n[7]=I(" 实际应付金额以订单支付详情页展示为准。 "))]),_:1})]),n[8]||(n[8]=i("div",{style:{"min-height":"50px"}},null,-1))]),d(Re,{ref_key:"addressChooseModalRef",ref:q,onChoose:L},null,512),i("div",xt,[i("div",wt,[d(Z,{title:"总金额（仅供参考）",value:S.value,precision:2,"value-from":0,start:!0,animation:""},{prefix:c(()=>n[9]||(n[9]=[I(" ￥ ")])),_:1},8,["value"])]),i("div",Tt,[d(K,{onClick:T,type:"text",style:{"margin-right":"20px",color:"grey"}},{default:c(()=>n[10]||(n[10]=[I("取消")])),_:1}),i("div",{class:"purchase-btn",onClick:k},[i("span",kt,[r.value?(b(),P(V,{key:0})):B("",!0),n[11]||(n[11]=I(" 确认并结算 "))])])])])])])]),_:1},8,["visible"])}}},Ot=se(It,[["__scopeId","data-v-c910e3f7"]]);export{Ot as O,mt as _,jt as a};

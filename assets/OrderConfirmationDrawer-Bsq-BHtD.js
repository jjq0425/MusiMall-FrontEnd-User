import{a as ge}from"./address-wPXXgvTV.js";import{c as ve,p as _e}from"./trade-N1dMiBST.js";import{g as V,_ as re,i as Q,r as g,a as N,o as b,f as d,d as c,w as l,j as O,t as $,h as C,e as P,m as he,C as J,b as W,q as ye,v as be,B as Ce,M as w,N as Y,A as xe}from"./index-rPxjcd1e.js";import{A as we}from"./address-uwJzlAFN.js";import{T as Te}from"./TradeList-BXMAJ5Bl.js";const U="/api/shoppingCart/v1/shoppingCart",ke=(e,o)=>V({url:`${U}/getShoppingCart`,method:"post",data:{pageNo:e,pageSize:o}}),jt=(e,o)=>V({url:`${U}/insertOrUpdate`,method:"post",data:{productId:e,quantity:o}}),Ie=e=>V({url:`${U}/deleteProduct/${e}`,method:"put"}),se=e=>V({url:`${U}/deleteProducts`,method:"put",data:e}),Oe=()=>V({url:`${U}/clearCart`,method:"put"}),Ae=(e,o)=>V({url:`${U}/updateShoppingCart`,method:"put",data:{id:e,quantity:o}}),Se={key:1,class:"address-item"},$e={class:"address-info"},Pe={class:"receiver-name"},je={class:"receiver-phone"},Ne={class:"full-address"},De={class:"address-actions"},qe={__name:"OrderAddressChoosedCard",emits:["changeAddress"],setup(e,{expose:o,emit:y}){const t=Q({id:"",receiverName:"",receiverPhone:"",province:"",city:"",district:"",detailAddress:"",postCode:""});o({setAddress:i=>{Object.assign(t,i)}});const _=()=>{v("changeAddress")},v=y;return(i,r)=>{const T=g("a-icon"),f=g("a-button");return b(),N("div",null,[t!=null&&t.id?(b(),N("div",Se,[c("div",$e,[c("p",Pe,$(t.receiverName),1),c("p",je,$(t==null?void 0:t.receiverPhone),1),c("p",Ne,$(t==null?void 0:t.province)+" / "+$(t==null?void 0:t.city)+" / "+$(t==null?void 0:t.district)+" / "+$(t==null?void 0:t.detailAddress),1)]),c("div",De,[d(f,{type:"primary",onClick:_},{default:l(()=>r[2]||(r[2]=[O("切换")])),_:1})])])):(b(),N("div",{key:0,class:"address-item address-empty",onClick:_},[d(T,{type:"exclamation-circle"}),r[1]||(r[1]=c("p",null,"您还没有选择收货地址",-1)),d(f,{type:"primary"},{default:l(()=>r[0]||(r[0]=[O("选择收货地址")])),_:1})]))])}}},Me=re(qe,[["__scopeId","data-v-e8f2aed1"]]),Re={__name:"AddressChooseModal",emits:["choose"],setup(e,{expose:o,emit:y}){const t=C(!1),m=C(null),_=()=>{m.value.initAddrress("choose"),t.value=!0},v=r=>{i("choose",r),t.value=!1},i=y;return o({showModal:_}),(r,T)=>{const f=g("a-modal");return b(),P(f,{visible:t.value,"onUpdate:visible":T[0]||(T[0]=k=>t.value=k),title:"选择地址",footer:null,width:800},{default:l(()=>[d(we,{ref_key:"addressManagementRef",ref:m,onChoose:v},null,512)]),_:1},8,["visible"])}}};var Le=typeof global=="object"&&global&&global.Object===Object&&global,Be=typeof self=="object"&&self&&self.Object===Object&&self,ie=Le||Be||Function("return this")(),X=ie.Symbol,le=Object.prototype,Ve=le.hasOwnProperty,Ue=le.toString,F=X?X.toStringTag:void 0;function ze(e){var o=Ve.call(e,F),y=e[F];try{e[F]=void 0;var t=!0}catch{}var m=Ue.call(e);return t&&(o?e[F]=y:delete e[F]),m}var Ee=Object.prototype,Fe=Ee.toString;function We(e){return Fe.call(e)}var Ge="[object Null]",Je="[object Undefined]",ne=X?X.toStringTag:void 0;function Qe(e){return e==null?e===void 0?Je:Ge:ne&&ne in Object(e)?ze(e):We(e)}function Xe(e){return e!=null&&typeof e=="object"}var He="[object Symbol]";function Ze(e){return typeof e=="symbol"||Xe(e)&&Qe(e)==He}var Ke=/\s/;function Ye(e){for(var o=e.length;o--&&Ke.test(e.charAt(o)););return o}var et=/^\s+/;function tt(e){return e&&e.slice(0,Ye(e)+1).replace(et,"")}function te(e){var o=typeof e;return e!=null&&(o=="object"||o=="function")}var ae=NaN,nt=/^[-+]0x[0-9a-f]+$/i,at=/^0b[01]+$/i,ot=/^0o[0-7]+$/i,rt=parseInt;function oe(e){if(typeof e=="number")return e;if(Ze(e))return ae;if(te(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=te(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=tt(e);var y=at.test(e);return y||ot.test(e)?rt(e.slice(2),y?2:8):nt.test(e)?ae:+e}var ee=function(){return ie.Date.now()},st="Expected a function",it=Math.max,lt=Math.min;function ct(e,o,y){var t,m,_,v,i,r,T=0,f=!1,k=!1,A=!0;if(typeof e!="function")throw new TypeError(st);o=oe(o)||0,te(y)&&(f=!!y.leading,k="maxWait"in y,_=k?it(oe(y.maxWait)||0,o):_,A="trailing"in y?!!y.trailing:A);function D(u){var s=t,n=m;return t=m=void 0,T=u,v=e.apply(n,s),v}function I(u){return T=u,i=setTimeout(j,o),f?D(u):v}function R(u){var s=u-r,n=u-T,a=o-s;return k?lt(a,_-n):a}function q(u){var s=u-r,n=u-T;return r===void 0||s>=o||s<0||k&&n>=_}function j(){var u=ee();if(q(u))return L(u);i=setTimeout(j,R(u))}function L(u){return i=void 0,A&&t?D(u):(t=m=void 0,v)}function M(){i!==void 0&&clearTimeout(i),T=0,t=r=m=i=void 0}function z(){return i===void 0?v:L(ee())}function S(){var u=ee(),s=q(u);if(t=arguments,m=this,r=u,s){if(i===void 0)return I(r);if(k)return clearTimeout(i),i=setTimeout(j,o),D(r)}return i===void 0&&(i=setTimeout(j,o)),v}return S.cancel=M,S.flush=z,S}const dt={style:{"font-size":"16px","font-weight":"bold"}},ut={style:{"font-size":"16px",color:"red","font-weight":"bold"}},pt={key:1},ft={class:"trade-item-picture"},mt={__name:"CartProductList",props:{canChange:{type:Boolean,default:!0}},emits:["updateTotalCount","updateSelectProductId","updateChangeItemLoading","updateTotalPrice"],setup(e,{expose:o,emit:y}){const t=Q([]),m=C(1);let _=10;const v=C(0),i=C(!1),r=C(!1),T=C(!1),f=Q([]),k=e,A=async()=>{r.value=!0,w.loading({content:"加载中...",id:"cart-data"});const a=await ke(m.value,_).finally(()=>{r.value=!1});i.value?_>0&&t.splice((m.value-1)*_,_,...a.data):t.push(...a.data),w.success({content:"加载成功",id:"cart-data"}),r.value=!1,t.length>=a.totalCount?i.value=!0:(i.value=!1,m.value++),v.value=a.totalCount,u()},D=async a=>{w.loading({content:"删除中...",id:"cart-data"});const p=await Ie(a);p.code===200?(w.success({content:p.message==null?"删除成功":p.message,id:"cart-data"}),R()):w.error({content:p.message==null?"删除失败":p.message,id:"cart-data"})},I=async()=>{if(console.log(f),f.length===0){w.warning({content:"请先选择要删除的商品"});return}w.loading({content:"删除中...",id:"cart-data"});const a=await se(f);a.code===200?(w.success({content:a.message==null?"删除成功":a.message,id:"cart-data"}),R()):w.error({content:a.message==null?"删除失败":a.message,id:"cart-data"})},R=()=>{t.splice(0,t.length),m.value=1,f.splice(0,f.length),A()},q=ct(async(a,p)=>{const h=await Ae(a,p);h.code===200||w.error({content:h.message==null?"更新失败":h.message})},1e3),j=a=>f.includes(a),L=a=>{if(f.includes(a)){const p=f.findIndex(h=>h===a);f.splice(p,1)}else f.push(a)},M=C(null),z=()=>{if(f.length===0){w.warning({content:"请先选择要结算的商品"});return}const p=t.filter(h=>f.includes(h.id)).map(h=>({cartId:h.id,productId:h.productId,quantity:h.quantity,productName:h.name,price:h.price,model:h.model,picture:h.cover}));M.value.showDrawer(JSON.stringify(p),"cartPart")},S=C(0),u=()=>{S.value=t.reduce((a,p)=>a+p.price*p.quantity,0),console.log(S.value)},s=()=>{if(t.length===0){w.warning({content:"购物车为空，无法结算"});return}M.value.showDrawer(null,"cartAll")};he(()=>{A(),k.canChange||(_=0)}),J(v,a=>{n("updateTotalCount",a)}),J(f,a=>{n("updateSelectProductId",a)}),J(T,a=>{n("updateChangeItemLoading",a)}),J(S,a=>{n("updateTotalPrice",a)});const n=y;return o({removeSelectCartItem:I,createOrderAll:s,createSelectOrder:z}),(a,p)=>{const h=g("a-empty"),H=g("icon-loading"),Z=g("a-spin"),K=g("a-checkbox"),B=g("a-descriptions-item"),E=g("a-input-number"),ce=g("a-button"),de=g("a-descriptions"),ue=g("a-list-item-meta"),pe=g("a-image"),fe=g("a-list-item"),me=g("a-list");return b(),N("div",null,[t.length===0&&!r.value?(b(),P(h,{key:0},{default:l(()=>p[0]||(p[0]=[O(" 购物车空空如也 ")])),_:1})):r.value&&t.length==0?(b(),P(h,{key:1},{image:l(()=>[d(H,{style:{"font-size":"68px",color:"#165dff"}})]),default:l(()=>[p[1]||(p[1]=c("div",{style:{"margin-top":"25px","font-size":"20px"}},"加载中，请稍后...",-1))]),_:1})):W("",!0),ye(d(me,{data:t,"max-height":500,onReachBottom:A,scrollbar:!0,style:{"overflow-y":"always",cursor:"pointer"},hoverable:""},{"scroll-loading":l(()=>[i.value&&!r.value?(b(),N("div",{key:0,onClick:A,style:{cursor:"pointer",color:"grey"}}," —— 我是有底线的 —— ")):(b(),P(Z,{key:1}))]),item:l(({item:x})=>[d(fe,null,{extra:l(()=>[c("div",ft,[d(pe,{src:x.cover,alt:x.productName,width:"110px",height:"110px"},null,8,["src","alt"])])]),default:l(()=>[d(ue,null,{avatar:l(()=>[k.canChange?(b(),P(K,{key:0,"model-value":j(x.id),onChange:G=>L(x.id)},null,8,["model-value","onChange"])):W("",!0)]),title:l(()=>[c("div",dt,[O($(x.productName)+" ",1),c("span",ut," ￥"+$((x.price*x.quantity).toFixed(2)),1)])]),description:l(()=>[d(de,{column:3,size:"small",style:{"margin-top":"10px",width:"95vh"}},{default:l(()=>[d(B,{label:"型号/描述",span:3},{default:l(()=>[O($(x.model),1)]),_:2},1024),d(B,{label:"单价"},{default:l(()=>[O("￥"+$(x.price.toFixed(2)),1)]),_:2},1024),d(B,{label:"购买数量"},{default:l(()=>[k.canChange?(b(),P(E,{key:0,modelValue:x.quantity,"onUpdate:modelValue":G=>x.quantity=G,min:1,max:x.stock,mode:"button",style:{width:"150px"},onChange:G=>Ce(q)(x.id,x.quantity)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])):(b(),N("span",pt,$(x.quantity),1))]),_:2},1024),k.canChange?(b(),P(B,{key:0,label:""},{default:l(()=>[d(ce,{type:"text",onClick:G=>D(x.id),style:{color:"red",transform:"translateX(-10vh)"}},{default:l(()=>p[2]||(p[2]=[O(" 移除 ")])),_:2},1032,["onClick"])]),_:2},1024)):W("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["data"]),[[be,t.length>0]]),d(It,{ref_key:"orderConfirmationDrawerRef",ref:M},null,512)])}}},gt={class:"order-confirmation"},vt={class:"card"},_t={class:"card"},ht={key:0,style:{"font-weight":"bold"}},yt={key:1},bt={class:"card"},Ct={class:"card"},xt={class:"floating-footer"},wt={class:"total-price"},Tt={class:"button-group"},kt={__name:"OrderConfirmationDrawer",emits:["confirmOrder"],setup(e,{expose:o,emit:y}){const t=C(!1),m=C(null),_=C(""),v=Q([]),i=C(null),r=C(!1),T=()=>{t.value=!1},f=async()=>{const s=await _e();i.value=s},k=async()=>{if(r.value==!0)return;if(r.value=!0,w.loading({content:"下单中...",id:"createOrder"}),!m.value.id){w.warning("请选择收货地址");return}if(v.length==0&&I.value!="cartAll"){w.warning("请选择商品");return}let s=null;I.value!="cartAll"&&(s=v.map(a=>({productId:a.productId,quantity:a.quantity})));const n=await ve(I.value==="cartAll"?"cartAll":"direct",i.value==null?null:i.value,m.value.id,s,_.value);n.traceNo?(setTimeout(()=>{r.value=!1,Y.success({title:"下单成功",content:"即将跳转到订单详情页，请尽快完成支付。实际应付金额以支付详情页为准。",duration:2e3}),xe.push({name:"Order-Detail",params:{id:n.traceNo}}),setTimeout(()=>{t.value=!1},1e3)},1e3),I.value==="cartAll"?(Oe(),u("confirmOrder")):I.value==="cartPart"&&(se(v.map(a=>a.cartId)),u("confirmOrder"))):(r.value=!1,Y.warning({title:"下单失败",content:n==null?void 0:n.message}))},A=C(null),D=async()=>{const s=await ge();m.value=s||null,A.value.setAddress(m.value)},I=C("direct"),R=(s,n="direct")=>{Y.info("请确认订单信息"),I.value=n,t.value=!0,D(),(n=="direct"||n=="cartPart")&&v.splice(0,v.length,...JSON.parse(s)),M(),f()},q=C(null),j=()=>{q.value.showModal()},L=s=>{m.value=s,A.value.setAddress(s)},M=()=>{S.value=v.reduce((s,n)=>s+n.price*n.quantity,0)},z=s=>{S.value=s},S=C(0),u=y;return o({showDrawer:R}),(s,n)=>{const a=g("icon-exclamation-circle-fill"),p=g("a-alert"),h=g("a-divider"),H=g("a-textarea"),Z=g("a-statistic"),K=g("a-button"),B=g("a-drawer");return b(),P(B,{visible:t.value,"onUpdate:visible":n[1]||(n[1]=E=>t.value=E),title:"请确认订单",placement:"bottom",height:650,footer:null,unmountOnClose:"","drawer-style":{borderRadius:"12px 12px 0 0",boxShadow:"0 -2px 8px rgba(0, 0, 0, 0.1)",zIndex:9990}},{default:l(()=>[c("div",gt,[c("div",vt,[n[2]||(n[2]=c("h2",{style:{"margin-bottom":"10px"}},"收货地址",-1)),d(Me,{ref_key:"orderAddressChoosedCardRef",ref:A,onChangeAddress:j},null,512)]),c("div",_t,[n[5]||(n[5]=c("h2",{style:{"margin-bottom":"10px"}},"商品列表",-1)),d(p,{type:"normal"},{icon:l(()=>[d(a)]),default:l(()=>[n[4]||(n[4]=O(" 请确认订单信息，价格以订单支付详情页展示为准。 ")),I.value=="cartAll"?(b(),N("span",ht,n[3]||(n[3]=[O("请注意当前为结算购物车"),c("span",{style:{color:"red"}},"全部商品",-1),O("。结算后将清空购物车。 ")]))):W("",!0),I.value=="cartPart"?(b(),N("span",yt,"结算后将从购物车中移除所购商品")):W("",!0)]),_:1}),I.value!="cartAll"?(b(),P(Te,{key:0,tradeItems:v},null,8,["tradeItems"])):(b(),P(mt,{key:1,canChange:!1,onUpdateTotalPrice:z}))]),d(h),c("div",bt,[n[6]||(n[6]=c("h3",null,"备注信息",-1)),d(H,{modelValue:_.value,"onUpdate:modelValue":n[0]||(n[0]=E=>_.value=E),placeholder:"填写备注信息"},null,8,["modelValue"])]),c("div",Ct,[d(p,{type:"normal"},{icon:l(()=>[d(a)]),default:l(()=>[n[7]||(n[7]=O(" 实际应付金额以订单支付详情页展示为准。 "))]),_:1})]),n[8]||(n[8]=c("div",{style:{"min-height":"50px"}},null,-1))]),d(Re,{ref_key:"addressChooseModalRef",ref:q,onChoose:L},null,512),c("div",xt,[c("div",wt,[d(Z,{title:"总金额（仅供参考）",value:S.value,precision:2,"value-from":0,start:!0,animation:""},{prefix:l(()=>n[9]||(n[9]=[O(" ￥ ")])),_:1},8,["value"])]),c("div",Tt,[d(K,{onClick:T,type:"text",style:{"margin-right":"20px",color:"grey"}},{default:l(()=>n[10]||(n[10]=[O("取消")])),_:1}),c("div",{class:"purchase-btn",onClick:k},n[11]||(n[11]=[c("span",{style:{color:"white","font-weight":"bold","font-size":"15px"}}," 确认并结算 ",-1)]))])])]),_:1},8,["visible"])}}},It=re(kt,[["__scopeId","data-v-b1566c8d"]]);export{It as O,mt as _,jt as a};

import{_ as I,c as _,a as w,d as o,t as s,A as L,o as m,B as V,s as Y,i as T,m as q,f as e,e as h,b as v,w as r,r as c,M as u,q as z,j as n,C as F,z as P}from"./index-D2LfOWUH.js";import{a as R,c as $}from"./trade-Cc8ycGTB.js";import{g as U}from"./address-viPRX29C.js";import{O as E}from"./OrderStatusTag-D-jJl0c-.js";import{T as W}from"./TradeList-COZwgQ7v.js";const G={class:"header-content"},J={style:{"margin-top":"10px"}},K={__name:"OrderHeader",props:{orderStatus:{type:Number,required:!0}},setup(O){const f=O,S=_(()=>{switch(f.orderStatus){case 1:return"订单待支付，快去付款吧！";case 2:return"已支付，宝贝正在路上~";case 4:return"订单已完成，感谢您的购买！";case 5:return"订单已取消，期待下次光临~";case 6:return"订单已退款，钱钱已退回~";default:return"订单状态未知"}}),g=_(()=>{switch(f.orderStatus){case 1:return"支付勿延俄顷间，订单将失君莫叹。尽快完成支付办，以免向隅空悲叹。";case 2:return"宝贝打包正忙时，请君耐心稍等候。不久便将寄君手，欢欣期待莫心焦。";case 4:return"喜得宝物愿君欢，使用愉快常相伴。欢迎再次来光顾，宾至如归情不散。";case 5:return"订单取消已成空，缘分散尽暂分别。期待下次再相遇，再见之时情更浓。";case 6:return"退款已回君账户，查收无误心自宽。钱钱归位喜盈怀，服务周到愿君还。";default:return"订单状态未可知，疑问重重心惑之。联系客服解君忧，答疑解惑不迟疑。"}}),t=_(()=>{switch(f.orderStatus){case 1:return"status-pending";case 2:return"status-paid";case 4:return"status-completed";case 5:return"status-cancelled";case 6:return"status-refunded";default:return"status-unknown"}});return(i,y)=>(m(),w("div",{class:L(["order-header",t.value])},[o("div",G,[o("h1",null,s(S.value),1),o("p",J,s(g.value),1)])],2))}},Q=I(K,[["__scopeId","data-v-ed165f78"]]),X={class:"order-detail-page"},Z={class:"order-info card"},ee={class:"address-info card"},te={class:"trade-items card"},re={class:"payment-info card"},ae={class:"remark-info card"},se={class:"floating-buttons animate__animated animate__fadeInUp"},oe={class:"button-container"},ne={key:1,style:{margin:"5px 0",color:"gray"}},de={__name:"OrderDetail",setup(O){const S=V().params.id,g=Y(),t=T({code:"",orderTime:"",orderStatus:0,payStatus:0,totalAmount:0,paymentAmount:0,remark:"",tradeItemList:[{productName:"",model:"",price:0,quantity:0,picture:""}]}),i=T({receiverName:"",receiverPhone:"",province:"",city:"",district:"",detailAddress:"",postCode:""}),y=async()=>{window.scrollTo(0,0),u.loading({content:"加载中...",id:"order-detail"});try{const d=await R(S);if(!d.data||d.data.length!=1){u.error({content:"订单不存在",id:"order-detail"}),z.push({name:"Order"});return}u.success({content:"获取订单详情成功",id:"order-detail"}),Object.assign(t,d.data[0]);const a=await U(t.deliveryAddressId);Object.assign(i,a)}catch{u.error({content:"获取订单详情失败",id:"order-detail"})}finally{}},C=d=>P(d).format("YYYY-MM-DD HH:mm:ss");_(()=>{switch(t.orderStatus){case 1:return"待支付";case 2:return"已支付";case 4:return"已完成";case 5:return"交易取消";case 6:return"退款退货";default:return"未知状态"}});const D=_(()=>{switch(t.payStatus){case 1:return"未支付";case 2:return"已支付";case 3:return"已退款";case 4:return"失败";default:return"未知状态"}}),A=()=>t.orderTime+15*60*1e3,N=()=>{u.info({content:"超时未支付，订单即将取消...",duration:4e3}),setTimeout(()=>{y()},3500)},B=async()=>{u.loading({content:"取消订单中...",id:"cancel-order"});try{await $(t.id),y()}catch(d){u.error({content:"取消订单失败: "+(d==null?void 0:d.message),id:"cancel-order"})}finally{}};return q(()=>{y()}),(d,a)=>{const M=c("a-countdown"),k=c("a-alert"),p=c("a-divider"),l=c("a-descriptions-item"),b=c("a-descriptions"),j=c("icon-exclamation-circle-fill"),x=c("a-button"),H=c("a-popconfirm");return m(),w("div",X,[e(Q,{class:"card",orderStatus:t.orderStatus},null,8,["orderStatus"]),t.orderStatus===1?(m(),h(k,{key:0},{default:r(()=>[a[0]||(a[0]=n(" 请在下单后的15分钟内完成支付，否则订单将自动取消。距离自动取消还有")),e(M,{format:"mm:ss.SSS",value:A(),"value-style":{color:"red",fontSize:"18px",fontWeight:"bold",marginLeft:"5px"},onFinish:N},null,8,["value"])]),_:1})):v("",!0),o("div",Z,[a[1]||(a[1]=o("h2",null,"订单信息",-1)),e(p),e(b,{column:"2"},{default:r(()=>[e(l,{label:"订单编号"},{default:r(()=>[n(s(t.id),1)]),_:1}),e(l,{label:"下单时间"},{default:r(()=>[n(s(C(t.orderTime)),1)]),_:1}),e(l,{label:"订单状态"},{default:r(()=>[e(E,{orderStatus:t.orderStatus},null,8,["orderStatus"])]),_:1}),e(l,{label:"下单用户"},{default:r(()=>[n(s(F(g).username),1)]),_:1})]),_:1})]),o("div",ee,[a[2]||(a[2]=o("h2",null,"地址信息",-1)),e(p),e(b,{column:3},{default:r(()=>[e(l,{label:"收件人",span:1},{default:r(()=>[n(s(i.receiverName),1)]),_:1}),e(l,{label:"电话",span:1},{default:r(()=>[n(s(i.receiverPhone),1)]),_:1}),e(l,{label:"邮编",span:1},{default:r(()=>[n(s(i.postCode),1)]),_:1}),e(l,{label:"省市区",span:1},{default:r(()=>[n(s(i.province)+" / "+s(i.city)+" / "+s(i.district),1)]),_:1}),e(l,{label:"详细地址",span:1},{default:r(()=>[n(s(i.detailAddress),1)]),_:1})]),_:1})]),o("div",te,[a[4]||(a[4]=o("h2",null,"商品信息",-1)),e(p),e(k,{type:"normal"},{icon:r(()=>[e(j)]),default:r(()=>[a[3]||(a[3]=n(" 仅代表下单时数据，与当前最新商品信息可能有差异或不同。 "))]),_:1}),e(W,{tradeItems:t.tradeItemList},null,8,["tradeItems"])]),o("div",re,[a[5]||(a[5]=o("h2",null,"支付信息",-1)),e(p),e(b,{column:"3"},{default:r(()=>[e(l,{label:"支付状态"},{default:r(()=>[n(s(D.value),1)]),_:1}),e(l,{label:"总金额"},{default:r(()=>[n("￥"+s(t.totalAmount.toFixed(2)),1)]),_:1}),e(l,{label:"应付金额"},{default:r(()=>[n("￥"+s(t.paymentAmount.toFixed(2)),1)]),_:1})]),_:1})]),o("div",ae,[a[6]||(a[6]=o("h2",null,"备注信息",-1)),e(p),o("p",null,s(t.remark||"无"),1)]),o("div",se,[o("div",oe,[e(H,{content:"确定取消订单吗？",onOk:B,type:"warning"},{default:r(()=>[t.orderStatus===1?(m(),h(x,{key:0,type:"primary",status:"danger"},{default:r(()=>a[7]||(a[7]=[n("取消订单")])),_:1})):v("",!0)]),_:1}),t.orderStatus===1?(m(),h(x,{key:0,type:"primary",onClick:d.goToPay},{default:r(()=>a[8]||(a[8]=[n(" 去支付 ")])),_:1},8,["onClick"])):v("",!0),t.orderStatus===5||t.orderStatus===6?(m(),w("div",ne," 感谢光临MusiMall，祝您购物愉快。 ")):v("",!0)])])])}}},pe=I(de,[["__scopeId","data-v-78fa2d93"]]);export{pe as default};

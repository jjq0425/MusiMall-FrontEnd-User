import{_ as z,c as $,a as c,o as s,b as Q,d as i,t as y,r as p,e as f,w as u,f as d,n as B,g as N,h,i as O,j as b,M as w,F as T,k as j,l as A}from"./index-CLUkJoio.js";import{O as F,a as R}from"./OrderConfirmationDrawer-Bg4wkPhX.js";import{_ as I}from"./address-DM-oQc8K.js";import"./address-CQUot1ao.js";import"./trade-oCk42qMb.js";import"./TradeList-Co-laW_8.js";const U={class:"price-stock"},E={key:0,class:"price"},W={key:1,class:"price",style:{color:"grey"}},G={class:"stock"},J={key:0,style:{color:"#f76707"}},X={key:1},H={key:2},K={key:3},Y={__name:"PriceAndStockShow",props:{price:{type:Number,required:!0},remainQuantity:{type:Number,required:!0},totalQuantity:{type:Number,required:!0}},setup(a){const o=a,r=$(()=>o.price.toFixed(2)),n=$(()=>o.remainQuantity<=0),t=$(()=>o.remainQuantity<=20&&o.remainQuantity>0),_=$(()=>o.totalQuantity-o.remainQuantity<=20);return(m,g)=>(s(),c("div",U,[n.value?Q("",!0):(s(),c("div",E," ￥ "+y(r.value),1)),n.value?(s(),c("div",W,"已售罄")):Q("",!0),i("div",G,[t.value?(s(),c("span",J,"库存告急，仅剩"+y(a.remainQuantity)+"件",1)):_.value?(s(),c("span",X,"新品上架，欢迎选购")):n.value?(s(),c("span",H,"商品已售罄，关注其他商品吧")):(s(),c("span",K,"已售："+y(a.totalQuantity-a.remainQuantity)+" 库存: "+y(a.remainQuantity),1))])]))}},Z=z(Y,[["__scopeId","data-v-357e4803"]]),tt={style:{"border-radius":"12px"}},et={__name:"ProductCard",props:{product:{type:Object,required:!0}},emits:["showProductDetailModal"],setup(a,{emit:o}){const r=a,n=()=>{t("showProductDetailModal",r.product.id)},t=o;return(_,m)=>{const g=p("a-image"),x=p("a-card-meta"),k=p("a-card");return s(),f(k,{hoverable:"",class:"product-card",onClick:n},{cover:u(()=>[i("div",tt,[d(g,{style:B([{overflow:"hidden"},{"border-radius":"12px 12px 18px 0"}]),width:"240px",height:"135px",src:a.product.picture,alt:a.product.name,preview:!1},null,8,["src","alt"])])]),default:u(()=>[d(x,{title:a.product.name,description:a.product.description.length>20?a.product.description.slice(0,18)+"...":a.product.description},{avatar:u(()=>[d(Z,{style:{transform:"translateX(-5px)"},price:a.product.price,totalQuantity:a.product.quantity,remainQuantity:a.product.remainQuantity},null,8,["price","totalQuantity","remainQuantity"])]),_:1},8,["title","description"])]),_:1})}}},at=z(et,[["__scopeId","data-v-fed52398"]]),q="/api/product/v1",ot=(a,o)=>N.get(`${q}/product`,{params:{page:a,pageSize:o,categoryName:null}}),nt=(a,o,r)=>N.get(`${q}/product/searchPage`,{params:{query:a,page:o,pageSize:r}}),st=a=>N.get(`${q}/product/${a}`),it={class:"product-detail-modal"},rt={class:"image-section"},lt={class:"info-section"},ct={class:"product-name"},ut={class:"description"},dt={key:0,class:"price"},pt={key:1,class:"price",style:{color:"grey"}},mt={class:"stock-info"},_t={class:"stock-text"},vt={class:"stock-text"},yt={style:{"border-radius":"12px"},class:"footer"},ft={key:0,class:"total-price"},ht={key:1,class:"purchase"},gt={class:"purchase-btn-group"},xt={__name:"ProductDetailModal",setup(a,{expose:o}){const r=h(!1),n=h(1),t=O({id:1,name:"商品名称",description:"商品描述",picture:"",price:100,quantity:1e3,remainQuantity:1e3});o({showModal:async v=>{n.value=1,w.loading({content:"加载中...",id:"productDetail"});const e=await st(v).catch(l=>{w.error({content:`获取商品详情失败,请稍后再试:${l}`,id:"productDetail"})});e.id!=null&&(Object.assign(t,e),console.log(t),r.value=!0,w.success({content:"加载成功",id:"productDetail",duration:500}))}});const m=h(!1),g=async()=>{if(m.value)return;if(m.value=!0,w.loading({content:"加入购物车中...",id:"addToCart"}),n.value>t.remainQuantity){w.error("购买数量超过库存");return}if(n.value<=0){w.error("购买数量不能小于1");return}const v=await R(t.id,n.value).finally(()=>{m.value=!1});v.code==200?w.success({content:v.message==null?"加入购物车成功":v.message,id:"addToCart",duration:500}):w.error({content:"加入购物车失败",id:"addToCart",duration:500}),m.value=!1,r.value=!1},x=h(null),k=()=>{r.value=!1;const v=JSON.stringify([{productId:t.id,productName:t.name,price:t.price,quantity:n.value,model:t.model,picture:t.picture}]);x.value.showDrawer(v)},S=$(()=>(t.price*n.value).toFixed(2));return(v,e)=>{const l=p("a-image"),P=p("a-tag"),M=p("a-input-number"),D=p("a-modal");return s(),f(D,{visible:r.value,"onUpdate:visible":e[1]||(e[1]=C=>r.value=C),title:"商品详情",width:1200,footer:null},{default:u(()=>[i("div",it,[i("div",rt,[i("div",null,[d(l,{src:t.picture,alt:t.name,class:"product-image",width:"400px",height:"400px"},null,8,["src","alt"])])]),i("div",lt,[i("h2",ct,y(t.name),1),i("p",ut,y(t.description),1),t.remainQuantity>0?(s(),c("div",dt," 单价: ￥"+y(t.price)+"/件 ",1)):(s(),c("div",pt,"已售罄")),i("div",mt,[i("span",_t," 已售: "+y(t.quantity-t.remainQuantity),1),i("span",vt," 剩余库存: "+y(t.remainQuantity),1),t.remainQuantity<=0?(s(),f(P,{key:0,color:"red",style:{"font-size":"12px"}},{default:u(()=>e[2]||(e[2]=[b(" 已售罄 ")])),_:1})):t.remainQuantity<=20?(s(),f(P,{key:1,color:"orange",style:{"font-size":"12px"}},{default:u(()=>e[3]||(e[3]=[b(" 库存告急 ")])),_:1})):t.quantity-t.remainQuantity<=20?(s(),f(P,{key:2,color:"green",style:{"font-size":"12px"}},{default:u(()=>e[4]||(e[4]=[b(" 新品发售 ")])),_:1})):(s(),f(P,{key:3,color:"blue",style:{"font-size":"12px"}},{default:u(()=>e[5]||(e[5]=[b("备货充足")])),_:1}))]),i("div",yt,[t.remainQuantity>0?(s(),c("div",ft,[e[6]||(e[6]=i("span",{style:{"font-weight":"bold"}},"总金额：",-1)),b(" ￥"+y(S.value),1)])):Q("",!0),t.remainQuantity>0?(s(),c("div",ht,[i("div",null,[d(M,{style:{width:"220px"},placeholder:"Please Enter",mode:"button",size:"large",class:"input-demo",modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=C=>n.value=C),min:1,max:t.remainQuantity},null,8,["modelValue","max"])]),i("div",gt,[i("div",{class:"purchase-btn",onClick:g},[d(I,{name:"shoppingCartWhite",size:"12px"}),e[7]||(e[7]=i("span",{style:{color:"white","font-weight":"bold","font-size":"15px"}}," 加入购物车 ",-1))]),i("div",{class:"purchase-btn-2",onClick:k},[d(I,{name:"makeOrderWhite",size:"13px"}),e[8]||(e[8]=i("span",{style:{color:"white","font-weight":"bold","font-size":"15px"}}," 直接购买 ",-1))])])])):Q("",!0)])])]),d(F,{ref_key:"OrderConfirmationDrawerRef",ref:x},null,512)]),_:1},8,["visible"])}}},wt=z(xt,[["__scopeId","data-v-14b9cef7"]]),kt={class:"product-list"},bt={__name:"ProductList",props:{productListInfo:{type:Array,required:!0}},setup(a){const o=h(null),r=n=>{o.value.showModal(n)};return(n,t)=>{const _=p("a-col"),m=p("a-row");return s(),c("div",kt,[d(m,{gutter:16},{default:u(()=>[(s(!0),c(T,null,j(a.productListInfo,g=>(s(),f(_,{key:g.id,span:6},{default:u(()=>[d(at,{product:g,onShowProductDetailModal:r},null,8,["product"])]),_:2},1024))),128))]),_:1}),d(wt,{ref_key:"showProductDetailModalRef",ref:o},null,512)])}}},Pt=z(bt,[["__scopeId","data-v-9d45e4f6"]]),Qt={class:"search"},Ct={class:"search-Btn-Div"},$t={class:"product-list-div"},zt={key:3,style:{height:"50px"}},Dt={key:4,class:"pagination-div"},St={__name:"product",setup(a){const o=h(""),r=h(!1),n=O([]),t=h(1),_=h(8),m=h(0);A(()=>{o.value="",x()});const g=()=>{o.value&&o.value.trim()!=""?k():x()},x=async()=>{r.value=!0;const e=await ot(t.value,_.value);n.splice(0,n.length,...e.data),m.value=e.totalCount,r.value=!1},k=async()=>{r.value=!0,t.value=1;const e=await nt(o.value,t.value,_.value).catch(l=>{w.error("搜索失败,请稍后再试:"+l),r.value=!1});n.splice(0,n.length,...e.data),m.value=e.totalCount,r.value=!1},S=e=>{t.value=e,o.value?k():x()},v=e=>{t.value=1,_.value=e,o.value?k():x()};return(e,l)=>{const P=p("icon-search"),M=p("a-input-search"),D=p("a-empty"),C=p("icon-loading"),V=p("a-pagination");return s(),c("div",null,[i("div",Qt,[l[2]||(l[2]=i("div",{class:"title"},[i("h1",{style:{margin:"0 auto","text-align":"center","font-size":"45px"}}," 优选好物 ")],-1)),i("div",Ct,[d(M,{class:"search-Btn",modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=L=>o.value=L),placeholder:"输入商品关键词","search-button":"",onSearch:g,loading:r.value},{"button-icon":u(()=>[d(P)]),"button-default":u(()=>l[1]||(l[1]=[b(" 搜好物 ")])),_:1},8,["modelValue","loading"])])]),i("div",$t,[n.length===0&&!r.value?(s(),f(D,{key:0,style:{"padding-top":"80px"}},{default:u(()=>l[3]||(l[3]=[b(" 没有搜索到商品 ")])),_:1})):r.value?(s(),f(D,{key:1,style:{"padding-top":"80px"}},{image:u(()=>[d(C,{style:{"font-size":"68px",color:"#165dff"}})]),default:u(()=>[l[4]||(l[4]=i("div",{style:{"margin-top":"25px","font-size":"20px"}},"加载中，请稍后...",-1))]),_:1})):(s(),f(Pt,{key:2,"product-list-info":n},null,8,["product-list-info"])),n.length>0&&!r.value?(s(),c("div",zt)):Q("",!0),n.length>0&&!r.value?(s(),c("div",Dt,[d(V,{total:m.value,current:t.value,"page-size":_.value,onChange:S,onPageSizeChange:v,"page-size-options":[8,16,32,64],"show-total":"","show-jumper":"","show-page-size":""},null,8,["total","current","page-size"])])):Q("",!0)])])}}},Lt=z(St,[["__scopeId","data-v-7f02f86c"]]);export{Lt as default};

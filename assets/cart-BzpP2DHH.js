import{h as F,j as N,m as tt,E as et,r as p,a as q,o as j,e as D,b as nt,q as at,w as s,i as O,d as x,f as m,v as ot,t as E,A as rt,M as C}from"./index-DLUgfbj1.js";import{g as it,u as st,r as lt}from"./cart-DLZHeYRO.js";var ct=typeof global=="object"&&global&&global.Object===Object&&global,ut=typeof self=="object"&&self&&self.Object===Object&&self,X=ct||ut||Function("return this")(),P=X.Symbol,H=Object.prototype,dt=H.hasOwnProperty,ft=H.toString,$=P?P.toStringTag:void 0;function mt(t){var e=dt.call(t,$),l=t[$];try{t[$]=void 0;var a=!0}catch{}var u=ft.call(t);return a&&(e?t[$]=l:delete t[$]),u}var pt=Object.prototype,gt=pt.toString;function _t(t){return gt.call(t)}var yt="[object Null]",vt="[object Undefined]",U=P?P.toStringTag:void 0;function bt(t){return t==null?t===void 0?vt:yt:U&&U in Object(t)?mt(t):_t(t)}function ht(t){return t!=null&&typeof t=="object"}var xt="[object Symbol]";function Tt(t){return typeof t=="symbol"||ht(t)&&bt(t)==xt}var Ct=/\s/;function jt(t){for(var e=t.length;e--&&Ct.test(t.charAt(e)););return e}var kt=/^\s+/;function St(t){return t&&t.slice(0,jt(t)+1).replace(kt,"")}function A(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var G=NaN,wt=/^[-+]0x[0-9a-f]+$/i,It=/^0b[01]+$/i,Ot=/^0o[0-7]+$/i,$t=parseInt;function Q(t){if(typeof t=="number")return t;if(Tt(t))return G;if(A(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=A(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=St(t);var l=It.test(t);return l||Ot.test(t)?$t(t.slice(2),l?2:8):wt.test(t)?G:+t}var R=function(){return X.Date.now()},Nt="Expected a function",Et=Math.max,Bt=Math.min;function Lt(t,e,l){var a,u,_,v,i,d,g=0,T=!1,b=!1,k=!0;if(typeof t!="function")throw new TypeError(Nt);e=Q(e)||0,A(l)&&(T=!!l.leading,b="maxWait"in l,_=b?Et(Q(l.maxWait)||0,e):_,k="trailing"in l?!!l.trailing:k);function S(n){var y=a,h=u;return a=u=void 0,g=n,v=t.apply(h,y),v}function V(n){return g=n,i=setTimeout(r,e),T?S(n):v}function M(n){var y=n-d,h=n-g,B=e-y;return b?Bt(B,_-h):B}function o(n){var y=n-d,h=n-g;return d===void 0||y>=e||y<0||b&&h>=_}function r(){var n=R();if(o(n))return f(n);i=setTimeout(r,M(n))}function f(n){return i=void 0,k&&a?S(n):(a=u=void 0,v)}function w(){i!==void 0&&clearTimeout(i),g=0,a=d=u=i=void 0}function z(){return i===void 0?v:f(R())}function I(){var n=R(),y=o(n);if(a=arguments,u=this,d=n,y){if(i===void 0)return V(d);if(b)return clearTimeout(i),i=setTimeout(r,e),S(d)}return i===void 0&&(i=setTimeout(r,e)),v}return I.cancel=w,I.flush=z,I}const Pt={style:{"font-size":"16px","font-weight":"bold"}},Vt={style:{"font-size":"16px",color:"red","font-weight":"bold"}},Mt={class:"trade-item-picture"},W=10,zt={__name:"CartProductList",emits:["updateTotalCount"],setup(t,{expose:e,emit:l}){const a=F([]),u=N(1),_=N(0),v=()=>_.value,i=N(!1),d=N(!1),g=F([]),T=async()=>{d.value=!0,C.loading({content:"加载中...",id:"cart-data"});const o=await it(u.value,W).finally(()=>{d.value=!1});i.value?a.splice((u.value-1)*W,W,...o.data):a.push(...o.data),C.success({content:"加载成功",id:"cart-data"}),d.value=!1,a.length>=o.totalCount?i.value=!0:(i.value=!1,u.value++),_.value=o.totalCount},b=async o=>{C.loading({content:"删除中...",id:"cart-data"});const r=await lt(o);if(r.code===200){C.success({content:r.message==null?"删除成功":r.message,id:"cart-data"});const f=a.findIndex(w=>w.id===o);f!==-1&&(a.splice(f,1),_.value--)}else C.error({content:r.message==null?"删除失败":r.message,id:"cart-data"})},k=Lt(async(o,r)=>{const f=await st(o,r);f.code===200||C.error({content:f.message==null?"更新失败":f.message})},1e3),S=o=>g.includes(o),V=o=>{if(g.includes(o)){const r=g.findIndex(f=>f===o);g.splice(r,1)}else g.push(o)};tt(()=>{T()}),et(_,o=>{M("updateTotalCount",o)});const M=l;return e({getTotalCount:v}),(o,r)=>{const f=p("a-empty"),w=p("icon-loading"),z=p("a-spin"),I=p("a-checkbox"),n=p("a-descriptions-item"),y=p("a-input-number"),h=p("a-button"),B=p("a-descriptions"),J=p("a-list-item-meta"),K=p("a-image"),Y=p("a-list-item"),Z=p("a-list");return j(),q("div",null,[a.length===0&&!d.value?(j(),D(f,{key:0},{default:s(()=>r[0]||(r[0]=[O(" 购物车空空如也 ")])),_:1})):d.value&&a.length==0?(j(),D(f,{key:1},{image:s(()=>[m(w,{style:{"font-size":"68px",color:"#165dff"}})]),default:s(()=>[r[1]||(r[1]=x("div",{style:{"margin-top":"25px","font-size":"20px"}},"加载中，请稍后...",-1))]),_:1})):nt("",!0),at(m(Z,{data:a,"max-height":500,onReachBottom:T,scrollbar:!0,style:{"overflow-y":"always",cursor:"pointer"},hoverable:""},{"scroll-loading":s(()=>[i.value&&!d.value?(j(),q("div",{key:0,onClick:T,style:{cursor:"pointer",color:"grey"}}," —— 我是有底线的 —— ")):(j(),D(z,{key:1}))]),item:s(({item:c})=>[m(Y,null,{extra:s(()=>[x("div",Mt,[m(K,{src:c.cover,alt:c.productName,width:"110px",height:"110px"},null,8,["src","alt"])])]),default:s(()=>[m(J,null,{avatar:s(()=>[m(I,{"model-value":S(c.id),onChange:L=>V(c.id)},null,8,["model-value","onChange"])]),title:s(()=>[x("div",Pt,[O(E(c.productName)+" ",1),x("span",Vt," ￥"+E((c.price*c.quantity).toFixed(2)),1)])]),description:s(()=>[m(B,{column:3,size:"small",style:{"margin-top":"10px",width:"95vh"}},{default:s(()=>[m(n,{label:"型号/描述",span:3},{default:s(()=>[O(E(c.model),1)]),_:2},1024),m(n,{label:"单价"},{default:s(()=>[O("￥"+E(c.price.toFixed(2)),1)]),_:2},1024),m(n,{label:"购买数量"},{default:s(()=>[m(y,{modelValue:c.quantity,"onUpdate:modelValue":L=>c.quantity=L,min:1,max:c.stock,mode:"button",style:{width:"150px"},onChange:L=>rt(k)(c.id,c.quantity)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])]),_:2},1024),m(n,{label:""},{default:s(()=>[m(h,{type:"text",onClick:L=>b(c.id),style:{color:"red",transform:"translateX(-10vh)"}},{default:s(()=>r[2]||(r[2]=[O(" 移除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["data"]),[[ot,a.length>0]])])}}},Dt={class:"cart-container"},Rt={style:{display:"flex","justify-content":"space-between"}},At={__name:"cart",setup(t){const e=N(0),l=a=>{e.value=a};return(a,u)=>(j(),q("div",Dt,[x("div",Rt,[u[0]||(u[0]=x("h2",{style:{"margin-bottom":"20px"}},"购物车",-1)),x("p",null,"共 "+E(e.value)+" 件商品",1)]),m(zt,{onUpdateTotalCount:l})]))}};export{At as default};
